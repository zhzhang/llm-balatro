---
import BaseHead from '../components/BaseHead.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			main {
				max-width: 720px;
				margin: 0 auto;
				padding: 4rem 2rem;
			}
			
			.article-header {
				margin-bottom: 3rem;
			}
			
			.article-subtitle {
				font-size: 1.125rem;
				color: var(--text-secondary);
				font-weight: 400;
				line-height: 1.6;
				margin-top: 0.5rem;
			}
			
			.article-content {
				line-height: 1.7;
			}
			
			.article-content ul, 
			.article-content ol {
				padding-left: 1.5rem;
			}
			
			@media (max-width: 768px) {
				main {
					padding: 3rem 1.5rem;
				}
			}
		</style>
	</head>
	<body>
		<main>
			<header class="article-header">
				<h1>Balatro Agent</h1>
				<p class="article-subtitle">
					Building an AI agent to master the poker roguelike sensation
				</p>
			</header>
			
			<article class="article-content">
				<p>
					<strong>Balatro</strong> combines poker hands with roguelike deck-building in a neon-soaked card game
					that took the gaming world by storm in 2024. This project documents my journey building a reinforcement 
					learning agent to play Balatro—from OCR and game state recognition to strategic decision-making.
				</p>

				<h2>The Challenge</h2>
				<p>
					Unlike traditional poker, Balatro layers complexity upon complexity: jokers that modify scoring rules, 
					planet cards that level up hand types, tarot cards that transform your deck, and shop phases that require 
					economic strategy. Can we build an AI agent that not only understands poker hands but masters the chaotic 
					synergies that make Balatro unique?
				</p>

				<h2>The Approach</h2>
				<p>
					Building an agent for a game without an API requires creative solutions. Here's how I approached the problem:
				</p>

				<h3>Computer Vision & State Recognition</h3>
				<p>
					The first challenge was extracting game state from screenshots. I developed an OCR pipeline to identify:
				</p>
				<ul>
					<li>Cards in hand (rank and suit)</li>
					<li>Active jokers and their effects</li>
					<li>Current chips, mult, and target score</li>
					<li>Available hands and discards</li>
					<li>Shop contents and pricing</li>
				</ul>

				<h3>Decision Making</h3>
				<p>
					The agent needs to make several types of decisions each turn:
				</p>
				<ul>
					<li><strong>Card Selection:</strong> Which cards to play for the current hand</li>
					<li><strong>Hand Type:</strong> Should we go for a high card, pair, flush, or something more ambitious?</li>
					<li><strong>Discard Strategy:</strong> When to use precious discards to improve the hand</li>
					<li><strong>Shop Decisions:</strong> What to buy, skip, or reroll</li>
					<li><strong>Joker Synergies:</strong> Building a coherent strategy across multiple jokers</li>
				</ul>

				<h3>Reinforcement Learning</h3>
				<p>
					The agent learns through trial and error, optimizing for:
				</p>
				<ul>
					<li>Maximizing score per hand</li>
					<li>Progressing through antes</li>
					<li>Efficient resource management (money, hands, discards)</li>
					<li>Long-term strategic planning vs. immediate gains</li>
				</ul>

				<h2>Results & Insights</h2>
				<p>
					Through thousands of gameplay runs, the agent discovered interesting strategies:
				</p>
				<ul>
					<li>Early game economy is crucial—sometimes skipping blinds for money pays off</li>
					<li>Certain joker combinations create exponential scaling</li>
					<li>Deck thinning (removing cards) often outperforms adding strong cards</li>
					<li>Planet cards should be prioritized for your most reliable hand type</li>
				</ul>

				<h2>Technical Stack</h2>
				<ul>
					<li><strong>Computer Vision:</strong> OpenCV, Tesseract OCR</li>
					<li><strong>ML Framework:</strong> PyTorch</li>
					<li><strong>Game Interaction:</strong> PyAutoGUI for input automation</li>
					<li><strong>Data Pipeline:</strong> SQLite for game history tracking</li>
				</ul>

				<h2>What's Next</h2>
				<p>
					Future improvements include:
				</p>
				<ul>
					<li>Better handling of rare joker combinations</li>
					<li>Multi-agent competition and strategy evolution</li>
					<li>Transfer learning across different stake levels</li>
					<li>Improved shop phase decision making</li>
				</ul>

				<p>
					Follow along as the agent continues to improve and discover new strategies in the wild world of Balatro!
				</p>
			</article>
		</main>
	</body>
</html>
