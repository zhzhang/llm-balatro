---
import BaseHead from "../components/BaseHead.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../consts";
import { readFile } from "fs/promises";
import { join } from "path";

// Load turn history index from static files
const indexPath = join(process.cwd(), "public", "turn-history", "index.json");
const indexContent = await readFile(indexPath, "utf-8");
const runMetadata = JSON.parse(indexContent) as Array<{
  agent: string;
  seed: string;
  runId: string;
  outcome: string;
  turns: number[];
}>;

// Create a map for quick lookup: agent -> seed -> outcome
const outcomeMap = new Map<string, Map<string, string>>();
for (const run of runMetadata) {
  if (!outcomeMap.has(run.agent)) {
    outcomeMap.set(run.agent, new Map());
  }
  outcomeMap.get(run.agent)!.set(run.seed, run.outcome);
}
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    <style>
      /* Custom CSS variables for colors not in Tailwind theme */
      :root {
        --text-link: var(--color-accent);
      }

      /* Selected table cell outline */
      td.selected {
        outline: 3px solid #2563eb;
        outline-offset: -3px;
      }

      /* Turn navigation buttons */
      .turn-controls button:not(:disabled):hover {
        background-color: var(--color-accent-hover) !important;
      }

      /* Turn browser layout - grid ensures text panel matches screenshot height */
      .turn-browser-layout {
        display: grid;
        grid-template-columns: 1fr minmax(0, 36rem);
        gap: 1rem;
      }

      /* Example state layout - grid ensures JSON panel matches screenshot height */
      .example-state-layout {
        display: grid;
        grid-template-columns: minmax(0, 1fr) minmax(0, 36rem);
        gap: 1rem;
      }

      .state-json-panel {
        position: relative;
        min-height: 0;
      }

      .state-json-content {
        position: absolute;
        inset: 0;
        overflow-y: auto;
        overflow-x: auto;
        padding: 1rem;
        background-color: var(--color-bg-secondary);
        border-radius: 0.5rem;
        margin: 0;
        white-space: pre;
      }

      .reasoning-panel {
        position: relative;
        min-height: 0;
      }

      .reasoning-content {
        position: absolute;
        inset: 0;
        overflow-y: auto;
        padding: 0 1rem;
      }

      /* Term popover tooltips */
      .term-popover::after {
        content: attr(data-definition);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%) translateY(-8px);
        background-color: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 0.75rem 1rem;
        border-radius: 6px;
        font-size: 0.875rem;
        line-height: 1.5;
        white-space: normal;
        width: max-content;
        max-width: 280px;
        text-align: left;
        opacity: 0;
        pointer-events: none;
        transition:
          opacity 0.2s ease,
          transform 0.2s ease;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      .term-popover::before {
        content: "";
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%) translateY(-2px);
        border: 6px solid transparent;
        border-top-color: rgba(0, 0, 0, 0.9);
        opacity: 0;
        pointer-events: none;
        transition:
          opacity 0.2s ease,
          transform 0.2s ease;
        z-index: 1000;
      }

      .term-popover:hover::after,
      .term-popover:hover::before {
        opacity: 1;
        transform: translateX(-50%) translateY(-4px);
      }

      .term-popover:hover::before {
        transform: translateX(-50%) translateY(2px);
      }

      @media (max-width: 768px) {
        main {
          padding: 4rem 1.5rem !important;
        }

        .article-header {
          margin-bottom: 3rem !important;
        }

        .article-subtitle {
          font-size: 1.125rem !important;
        }

        .table-container {
          width: calc(100vw - 3rem) !important;
          overflow-x: auto;
        }

        .turn-details {
          height: auto !important;
          max-height: 500px !important;
        }

        .turn-controls {
          grid-template-columns: 1fr !important;
          grid-template-rows: auto auto auto !important;
          gap: 0.75rem !important;
        }

        .turn-controls button:first-child {
          justify-self: stretch !important;
        }

        .turn-controls button:last-child {
          justify-self: stretch !important;
        }

        .turn-controls button {
          width: 100% !important;
        }

        .term-popover::after {
          max-width: 200px !important;
          font-size: 0.8rem !important;
        }

        .example-state-layout {
          grid-template-columns: 1fr !important;
        }

        .state-json-panel {
          position: relative !important;
          height: auto !important;
          max-height: 300px !important;
        }

        .state-json-content {
          position: relative !important;
          inset: auto !important;
        }
      }
    </style>
  </head>
  <body>
    <main class="max-w-[760px] mx-auto py-20 px-8">
      <header
        class="article-header mb-16 pb-8 border-b"
        style="border-color: var(--color-border-light);"
      >
        <h1 class="mb-4">Can LLMs beat Balatro?</h1>
        <p
          class="article-subtitle text-xl font-normal leading-relaxed"
          style="font-family: var(--font-family-serif); color: var(--color-text-secondary);"
        >
          In short: yes, and now I'm betting on Google to win the AI race.
        </p>
        <p
          class="text-sm mt-2 flex items-center gap-3"
          style="color: var(--color-text-secondary);"
        >
          <a
            href="https://www.linkedin.com/in/zhjzhang/"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-1.5 border-b border-transparent transition-colors duration-200 hover:border-[var(--color-accent)]"
            style="color: var(--color-accent);"
          >
            <svg
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
              class="w-[18px] h-[18px] fill-current"
            >
              <path
                d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"
              ></path>
            </svg>
            Jordan Zhang
          </a>
          <span>•</span>
          <a
            href="https://github.com/zhzhang/llm-balatro/tree/main/experiment-code"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-1.5 border-b border-transparent transition-colors duration-200 hover:border-[var(--color-accent)]"
            style="color: var(--color-accent);"
          >
            <svg
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
              class="w-[18px] h-[18px] fill-current"
            >
              <path
                d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
              ></path>
            </svg>
            Code
          </a>
        </p>
      </header>

      <article class="leading-[1.8]">
        <p>
          <strong>Balatro</strong> is a <span
            class="term-popover relative underline decoration-dotted cursor-help"
            style="text-decoration-color: var(--color-accent); color: inherit;"
            data-definition="A game genre where progress is procedurally generated, features permanent death, and requires players to restart from the beginning when they die."
            >roguelike</span
          >
          <span
            class="term-popover relative underline decoration-dotted cursor-help"
            style="text-decoration-color: var(--color-accent); color: inherit;"
            data-definition="A game genre where players build and customize a deck of cards throughout the game, making strategic choices about which cards to add, remove, or upgrade."
            >deckbuilder</span
          > based on poker that was released in 2024. Players play poker hands to
          earn chips and pass rounds, trying to exceed exponentially increasing chip
          requirement as rounds progress.
        </p>

        <div
          class="my-8 w-[calc(100vw-4rem)] max-w-[1400px] relative left-1/2 -translate-x-1/2 flex gap-6 justify-center items-start"
        >
          <div class="flex-1 flex flex-col items-center">
            <img
              src="/gifs/balatro-1.gif"
              alt="Balatro gameplay 1"
              class="w-full h-auto rounded-lg shadow-md"
            />
            <p
              class="mt-3 text-[0.85rem] text-center"
              style="color: var(--color-text-secondary);"
            >
              1. Start playing regular poker hands to earn money.
            </p>
          </div>
          <div class="flex-1 flex flex-col items-center">
            <img
              src="/gifs/balatro-2.gif"
              alt="Balatro gameplay 2"
              class="w-full h-auto rounded-lg shadow-md"
            />
            <p
              class="mt-3 text-[0.85rem] text-center"
              style="color: var(--color-text-secondary);"
            >
              2. Buy and use power ups to stack the deck in your favor.
            </p>
          </div>
          <div class="flex-1 flex flex-col items-center">
            <img
              src="/gifs/balatro-3.gif"
              alt="Balatro gameplay 3"
              class="w-full h-auto rounded-lg shadow-md"
            />
            <p
              class="mt-3 text-[0.85rem] text-center"
              style="color: var(--color-text-secondary);"
            >
              3. Build OP combos and win the game.
            </p>
          </div>
        </div>

        <p>Balatro is an interesting test bed for LLM reasoning because:</p>
        <ul>
          <li>
            It is stochastic with an enormous branching factor, requiring
            probabilistic reasoning to make optimal decisions.
          </li>
          <li>
            Long range planning and execution are needed to curate strong enough combos and decks that can keep up with
            the exponentially increasing chip requirement.
          </li>
          <li>Being turn-based, with no real-time or visuospatial qualities, the game is completely playable in text form.</li>
        </ul>

		<div
          class="my-8 w-[calc(100vw-4rem)] max-w-[1400px] relative left-1/2 -translate-x-1/2 border rounded-lg p-4"
          style="border-color: var(--color-border-light);"
        >
          <p class="text-sm mb-4" style="color: var(--color-text-secondary);">
            An example game state and corresponding screenshot from Ante 7:
          </p>
          <div class="example-state-layout">
            <div class="state-json-panel">
              <pre
                class="state-json-content text-xs leading-relaxed"
                style="color: var(--color-text-secondary);"
              >{JSON.stringify(JSON.parse(JSON.parse((await readFile(join(process.cwd(), "public", "turn-history", "openai", "422J6NUH", "170.json"), "utf-8"))).state).game_state, null, 2)}</pre>
            </div>
            <div>
              <img
                src="/turn-history/openai/422J6NUH/170.png"
                alt="Ante 7 game state screenshot"
                class="w-full h-auto border rounded"
                style="border-color: var(--color-border-light);"
              />
            </div>
          </div>
        </div>

        <p>
			As I was interested in the agents' decision making abilities, and not their ability to navigate and click around the game's UI to do things,
			I elected to mod the game to stringify the state as JSON, rather than working with the agents through screenshots. Parts
			of the mod code are available in the <a href="https://github.com/zhzhang/llm-balatro/tree/main/experiment-code" target="_blank" rel="noopener noreferrer">experiment-code</a> repository for your reference,
			though I have not had a chance to formally turn it into a <a href="https://github.com/Steamodded/smods" target="_blank" rel="noopener noreferrer">Steamodded</a> mod.
        </p>

        <p>
		The experimental setup was as follows:
		</p>
		<ul>
		<li>
			I had models from OpenAI, Claude, and Google each play 10 games
			using the same set of 10 run seeds, to reduce the effect of run-to-run variance in the comparison.
		</li>
		<li>
			The maximum thinking effort setting for each model was used.
		</li>
		<li>
			I gave a system prompt that explained the general rules and flow of the game, which can be viewed <a href="https://github.com/zhzhang/llm-balatro/blob/main/experiment-code/prompts.py#L88" target="_blank" rel="noopener noreferrer">here</a>.
			The system prompt does not provide any information on specific instances of game objects like jokers, cards, consumable, or bosses, and does not give any strategies for playing the game.
		</li>
		<li>
			Because the rules for scoring hands can involve very long sequences of cards triggering compounding special effects, I help the agent gauge the amount of chips it might earn by playing a hand by providing a history of the last 7 hands played.
			This backwards looking memory of recent hands played is similar in feeling to how a human player gauges how "strong" any given played hand might be.
		</li>
		<li>
			In addition to the current state, I also provided the state, action taken, and agent's reasoning for the last 3 turns, to help maintain some tactical continuity across turns. 
		</li>
		</ul>
		<p>
		  Here are the results, including the average cost per turn for each model:
        </p>

        <div
          class="table-container my-8 w-[calc(100vw-4rem)] max-w-[1400px] relative left-1/2 -translate-x-1/2 border rounded-lg p-4"
          style="border-color: var(--color-border-light);"
        >
          <table class="outcomes-table w-full border-collapse text-sm">
            <thead>
              <tr>
                <th
                  class="p-3 text-center border font-semibold sticky top-0"
                  style="border-color: var(--color-border-light); background-color: var(--color-bg-secondary);"
                  >Seed</th
                >
                <th
                  class="p-3 text-center border font-semibold sticky top-0"
                  style="border-color: var(--color-border-light); background-color: var(--color-bg-secondary);"
                  >Cost per turn</th
                >
                <th
                  class="p-3 text-center border font-semibold sticky top-0"
                  style="border-color: var(--color-border-light); background-color: var(--color-bg-secondary);"
                  >22V4E3UE</th
                >
                <th
                  class="p-3 text-center border font-semibold sticky top-0"
                  style="border-color: var(--color-border-light); background-color: var(--color-bg-secondary);"
                  >2JW2IH4X</th
                >
                <th
                  class="p-3 text-center border font-semibold sticky top-0"
                  style="border-color: var(--color-border-light); background-color: var(--color-bg-secondary);"
                  >422J6NUH</th
                >
                <th
                  class="p-3 text-center border font-semibold sticky top-0"
                  style="border-color: var(--color-border-light); background-color: var(--color-bg-secondary);"
                  >5U4K91D8</th
                >
                <th
                  class="p-3 text-center border font-semibold sticky top-0"
                  style="border-color: var(--color-border-light); background-color: var(--color-bg-secondary);"
                  >84N5GIYF</th
                >
                <th
                  class="p-3 text-center border font-semibold sticky top-0"
                  style="border-color: var(--color-border-light); background-color: var(--color-bg-secondary);"
                  >H1Z58VZ6</th
                >
                <th
                  class="p-3 text-center border font-semibold sticky top-0"
                  style="border-color: var(--color-border-light); background-color: var(--color-bg-secondary);"
                  >M3F6LPGY</th
                >
                <th
                  class="p-3 text-center border font-semibold sticky top-0"
                  style="border-color: var(--color-border-light); background-color: var(--color-bg-secondary);"
                  >M8KADSBQ</th
                >
                <th
                  class="p-3 text-center border font-semibold sticky top-0"
                  style="border-color: var(--color-border-light); background-color: var(--color-bg-secondary);"
                  >PE93PR87</th
                >
                <th
                  class="p-3 text-center border font-semibold sticky top-0"
                  style="border-color: var(--color-border-light); background-color: var(--color-bg-secondary);"
                  >U15QWQGE</th
                >
              </tr>
            </thead>
            <tbody>
              <tr>
                <th
                  class="p-3 border font-semibold text-left"
                  style="border-color: var(--color-border-light); background-color: var(--color-bg-secondary);"
                  >claude-4.5-sonnet</th
                >
                <td
                  class="p-3 text-center border"
                  style="border-color: var(--color-border-light);">$0.058</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="claude"
                  data-seed="22V4E3UE">Ante 6</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="claude"
                  data-seed="2JW2IH4X">Ante 6</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="claude"
                  data-seed="422J6NUH">Ante 5</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="claude"
                  data-seed="5U4K91D8">Ante 6</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="claude"
                  data-seed="84N5GIYF">Ante 4</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="claude"
                  data-seed="H1Z58VZ6">Ante 5</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="claude"
                  data-seed="M3F6LPGY">Ante 2</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="claude"
                  data-seed="M8KADSBQ">Ante 5</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="claude"
                  data-seed="PE93PR87">Ante 3</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="claude"
                  data-seed="U15QWQGE">Ante 4</td
                >
              </tr>
              <tr>
                <th
                  class="p-3 border font-semibold text-left"
                  style="border-color: var(--color-border-light); background-color: var(--color-bg-secondary);"
                  >gpt-5.2</th
                >
                <td
                  class="p-3 text-center border"
                  style="border-color: var(--color-border-light);">$0.034</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="openai"
                  data-seed="22V4E3UE">Ante 5</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="openai"
                  data-seed="2JW2IH4X">Ante 5</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="openai"
                  data-seed="422J6NUH">Ante 7</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="openai"
                  data-seed="5U4K91D8">Ante 7</td
                >
                <td
                  class="clickable won p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-green-50 text-green-600 font-semibold"
                  style="border-color: var(--color-border-light);"
                  data-agent="openai"
                  data-seed="84N5GIYF">WON</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="openai"
                  data-seed="H1Z58VZ6">Ante 6</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="openai"
                  data-seed="M3F6LPGY">Ante 4</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="openai"
                  data-seed="M8KADSBQ">Ante 5</td
                >
                <td
                  class="clickable won p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-green-50 text-green-600 font-semibold"
                  style="border-color: var(--color-border-light);"
                  data-agent="openai"
                  data-seed="PE93PR87">WON</td
                >
                <td
                  class="clickable won p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-green-50 text-green-600 font-semibold"
                  style="border-color: var(--color-border-light);"
                  data-agent="openai"
                  data-seed="U15QWQGE">WON</td
                >
              </tr>
              <tr>
                <th
                  class="p-3 border font-semibold text-left"
                  style="border-color: var(--color-border-light); background-color: var(--color-bg-secondary);"
                  >gemini-3-flash</th
                >
                <td
                  class="p-3 text-center border"
                  style="border-color: var(--color-border-light);">$0.008</td
                >
                <td
                  class="clickable won p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-green-50 text-green-600 font-semibold"
                  style="border-color: var(--color-border-light);"
                  data-agent="gemini"
                  data-seed="22V4E3UE">WON</td
                >
                <td
                  class="clickable won p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-green-50 text-green-600 font-semibold"
                  style="border-color: var(--color-border-light);"
                  data-agent="gemini"
                  data-seed="2JW2IH4X">WON</td
                >
                <td
                  class="clickable won p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-green-50 text-green-600 font-semibold"
                  style="border-color: var(--color-border-light);"
                  data-agent="gemini"
                  data-seed="422J6NUH">WON</td
                >
                <td
                  class="clickable won p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-green-50 text-green-600 font-semibold"
                  style="border-color: var(--color-border-light);"
                  data-agent="gemini"
                  data-seed="5U4K91D8">WON</td
                >
                <td
                  class="clickable won p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-green-50 text-green-600 font-semibold"
                  style="border-color: var(--color-border-light);"
                  data-agent="gemini"
                  data-seed="84N5GIYF">WON</td
                >
                <td
                  class="clickable won p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-green-50 text-green-600 font-semibold"
                  style="border-color: var(--color-border-light);"
                  data-agent="gemini"
                  data-seed="H1Z58VZ6">WON</td
                >
                <td
                  class="clickable lost p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-red-50 text-red-500"
                  style="border-color: var(--color-border-light);"
                  data-agent="gemini"
                  data-seed="M3F6LPGY">Ante 4</td
                >
                <td
                  class="clickable won p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-green-50 text-green-600 font-semibold"
                  style="border-color: var(--color-border-light);"
                  data-agent="gemini"
                  data-seed="M8KADSBQ">WON</td
                >
                <td
                  class="clickable won p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-green-50 text-green-600 font-semibold"
                  style="border-color: var(--color-border-light);"
                  data-agent="gemini"
                  data-seed="PE93PR87">WON</td
                >
                <td
                  class="clickable won p-3 text-center border cursor-pointer transition-all duration-200 hover:scale-105 hover:shadow-lg bg-green-50 text-green-600 font-semibold"
                  style="border-color: var(--color-border-light);"
                  data-agent="gemini"
                  data-seed="U15QWQGE">WON</td
                >
              </tr>
            </tbody>
          </table>
          <p class="mb-4 text-center italic text-sm" style="color: var(--color-text-secondary); opacity: 0.85;">
            Select a run from the table above to view the turn-by-turn history and agent reasoning of that run.
          </p>
          <div id="turn-browser" class="max-w-full">
            <div class="turn-browser-layout">
              <div class="bg-white p-4 rounded">
                <div
                  class="turn-controls grid gap-4 mb-4 items-center"
                  style="grid-template-columns: auto 1fr auto;"
                >
                  <button
                    id="prev-turn-btn"
                    class="px-4 py-2 rounded font-medium transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                    style="background-color: var(--color-accent); color: white; border: none;"
                    disabled
                  >
                    ← Previous
                  </button>
                  <span
                    id="turn-indicator"
                    class="text-center font-medium"
                    style="color: var(--color-text-secondary);"
                  >
                    Turn 1 of 1
                  </span>
                  <button
                    id="next-turn-btn"
                    class="px-4 py-2 rounded font-medium transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                    style="background-color: var(--color-accent); color: white; border: none;"
                    disabled
                  >
                    Next →
                  </button>
                </div>
                <img
                  id="screenshot-img"
                  alt="Game state screenshot"
                  class="w-full h-auto border rounded block"
                  style="border-color: var(--color-border-light);"
                  src="/turn-history/gemini/84N5GIYF/0.png"
                />
              </div>
              <div class="reasoning-panel">
                <div class="reasoning-content">
                  <h3 id="action-heading" class="text-lg font-semibold mb-3">Agent Reasoning</h3>
                  <div
                    id="reasoning-text"
                    class="text-sm leading-relaxed whitespace-pre-wrap"
                    style="color: var(--color-text-secondary);"
                  >
                    Loading...
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div
            id="loading-message"
            class="text-center py-8"
            style="display: none;"
          >
            Loading turn history...
          </div>
        </div>
      </article>
      <p>
        Notably, gemini-3-<em>flash</em> trounces both claude-4.5-sonnet and gpt-5.2,
        despite the latter two being bigger and more expensive. I originally planned
		comparisons all of the same "default" model size for each company, but during testing,
		gemini-3-flash as winning games so reliably that I decided to save some money and continue
		running with it.
      </p>
	  
	  <p>
		What tipped me off to what was happening was turn 9 of the gemini run on seed 5U4K91D8.
		In its reasoning, gemini mentions offhandedly that the Blank Voucher, although it says "Does nothing?" in the description,
		actually unlocks the Antimatter Voucher for the run, which allows the player to have an extra joker slot.
		The thing is <em>none of this information is in the system prompt or the state passed to the model</em>.
	  </p>

	  <p>
		Scrolling through the turn-by-turn history of gemini runs, it became clear that gemini simply <em>knew more</em> about the game
		than the other two models.
	  </p>

      <p>
        The reason for this gap, Google's secret weapon in the current AI race:
        Youtube. When I originally started the agent development with Claude,
        performance was poor, and I looked for a textual guide to see if I could
        hand the manual strategy for success. (I also tried briefly implementing
        Reflexion, as well as an AlphaEvolve-based evolutionary algorithm) Good,
        comprehensive text-based guides were very hard to find, but Youtube had
        tons of content from streamers, breaking down strategies and gameplay.
        When watching gemini play, I noticed within the first couple of Antes
        that it knew more about the game than the other two models, certainly
        more than was possible from the state context I was giving it.
      </p>

      <p>
        At the end of the day, the Bitter Lesson is that this AI race is about
        scaling compute and data, and teams that have access to more and better
        of both will win. This experiment has woken me up to how unfair of an
        advantage Youtube is in the AI race. The sheer amount of high fidelity
        multi-modal explanations of pretty much any topic you can imagine
        creates a data moat that companies starting from scraping the internet
        struggle to match. If you have the right data for a specific domain, you
        can create outsize impact for 10x cheaper.
      </p>
    </main>

    <footer
      class="max-w-[760px] mx-auto py-8 px-8 border-t text-center text-sm"
      style="border-color: var(--color-border-light); color: var(--color-text-secondary);"
    >
      <p>
        © {new Date().getFullYear()}
        <a
          href="https://www.linkedin.com/in/zhjzhang/"
          target="_blank"
          rel="noopener noreferrer"
          class="border-b border-transparent transition-colors duration-200 hover:border-[var(--color-accent)]"
          style="color: var(--color-accent);"
        >
          Jordan Zhang
        </a>
      </p>
    </footer>

    <script is:inline define:vars={{ runMetadata }}>
      // State for current selection
      let currentAgent = null;
      let currentSeed = null;
      let currentTurnIndex = 0;
      let currentTurns = [];

      // DOM elements
      const screenshotImg = document.getElementById("screenshot-img");
      const reasoningText = document.getElementById("reasoning-text");
      const actionHeading = document.getElementById("action-heading");
      const turnIndicator = document.getElementById("turn-indicator");
      const prevBtn = document.getElementById("prev-turn-btn");
      const nextBtn = document.getElementById("next-turn-btn");

      // Find run metadata by agent and seed
      function findRun(agent, seed) {
        return runMetadata.find((r) => r.agent === agent && r.seed === seed);
      }

      // Update the turn display
      async function updateTurnDisplay() {
        if (!currentAgent || !currentSeed || currentTurns.length === 0) return;

        const turn = currentTurns[currentTurnIndex];

        // Update screenshot
        screenshotImg.src = `/turn-history/${currentAgent}/${currentSeed}/${turn}.png`;

        // Update reasoning and action
        try {
          const response = await fetch(
            `/turn-history/${currentAgent}/${currentSeed}/${turn}.json`,
          );
          const data = await response.json();
          reasoningText.textContent =
            data.reasoning || "No reasoning available";
          actionHeading.textContent =
            data.action || "Agent Action";
        } catch (e) {
          reasoningText.textContent = "Failed to load reasoning";
          actionHeading.textContent = "Agent Action";
        }

        // Update turn indicator
        turnIndicator.textContent = `Turn ${currentTurnIndex + 1} of ${currentTurns.length}`;

        // Update button states
        prevBtn.disabled = currentTurnIndex === 0;
        nextBtn.disabled = currentTurnIndex === currentTurns.length - 1;
      }

      // Select a run from the table
      function selectRun(agent, seed) {
        const run = findRun(agent, seed);
        if (!run) return;

        // Update selection state
        currentAgent = agent;
        currentSeed = seed;
        currentTurns = run.turns;
        currentTurnIndex = 0;

        // Clear previous selection
        document
          .querySelectorAll("td.selected")
          .forEach((td) => td.classList.remove("selected"));

        // Highlight selected cell
        const cell = document.querySelector(
          `td[data-agent="${agent}"][data-seed="${seed}"]`,
        );
        if (cell) cell.classList.add("selected");

        updateTurnDisplay();
      }

      // Navigation handlers
      prevBtn.addEventListener("click", () => {
        if (currentTurnIndex > 0) {
          currentTurnIndex--;
          updateTurnDisplay();
        }
      });

      nextBtn.addEventListener("click", () => {
        if (currentTurnIndex < currentTurns.length - 1) {
          currentTurnIndex++;
          updateTurnDisplay();
        }
      });

      // Keyboard navigation
      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowLeft") {
          prevBtn.click();
        } else if (e.key === "ArrowRight") {
          nextBtn.click();
        }
      });

      // Click handlers for table cells
      document.querySelectorAll("td.clickable").forEach((cell) => {
        cell.addEventListener("click", () => {
          const agent = cell.dataset.agent;
          const seed = cell.dataset.seed;
          selectRun(agent, seed);
        });
      });

      // Initialize with first available run
      if (runMetadata.length > 0) {
        const firstRun = runMetadata[0];
        selectRun(firstRun.agent, firstRun.seed);
      }
    </script>
  </body>
</html>
